<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/style.css">

    <title>The CARROT Protocol | The Decentralized Reserve Currency</title>
    <meta
        content="CARROT is building a community-owned decentralized financial infrastructure to bring more stability and transparency for the world."
        name="description">
    <meta content="The CARROT Protocol | The Decentralized Reserve Currency" property="og:title">
    <meta
        content="CARROT is building a community-owned decentralized financial infrastructure to bring more stability and transparency for the world."
        property="og:description">
    <meta content="./assets/CARROT.png" property="og:image">
    <meta content="The CARROT Protocol | The Decentralized Reserve Currency" property="twitter:title">
    <meta
        content="CARROT is building a community-owned decentralized financial infrastructure to bring more stability and transparency for the world."
        property="twitter:description">
    <meta content="./assets/CARROT.png" property="twitter:image">
    <meta property="og:type" content="website">
    <meta content="summary_large_image" name="twitter:card">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <link href="./assets/CARROT.png" rel="shortcut icon" type="image/x-icon">
    <link href="./assets/CARROT.png" rel="apple-touch-icon">

    <meta name="twitter:image" content="./assets/CARROT.png">
    <meta name="twitter:description"
        content="CARROT is building a community-owned decentralized financial infrastructure to bring more stability and transparency for the world.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The CARROT Protocol | The Decentralized Reserve Currency">

    <meta property="og:image" content="./assets/CARROT.png">
</head>

<body id="carrto-finance" style="margin-bottom: 100px;">
    <div class="container-fluid">
        <div class="row">
            <div id="sidebarContainer" class="col-auto" style="z-index: 1000002;">
                <div id="sidebar" class="d-flex flex-column align-items-center pe-2 py-4">
                    <a id="logo" href=""
                        class="text-decoration-none mb-5 w-100 d-flex align-items-center ps-3 pe-2">
                        <img src="./assets/CARROT.png" alt="logo-icon" class="col-2">
                    </a>

                    <ul id="sidebar-nav" class="list-unstyled p-0 py-5">
                        <li class="mb-4 py-2 px-5 rounded-pill">
                            <a href="index.html" class="text-decoration-none text-reset d-flex align-items-center">
                                <span class="ms-3">Dashboard</span>
                            </a>
                        </li>
                        <li class="mb-4 py-2 px-5 rounded-pill active">
                            <a href="stake.html" class="text-decoration-none text-reset d-flex align-items-center">
                                <span class="ms-3">Stake CARROT</span>
                            </a>
                        </li>
                        <li class="mb-4 py-2 px-5 rounded-pill">
                            <a href="stakelp.html" class="text-decoration-none text-reset d-flex align-items-center">
                                <span class="ms-3">Stake LP</span>
                            </a>
                        </li>
                        <li class="mb-4 py-2 px-5 rounded-pill">
                            <a href="https://app.zyberswap.io/exchange/swap?outputCurrency=0x8418B8BFF5a9979e26091922bF8614b78e93c44B"
                                class="text-decoration-none text-reset d-flex align-items-center">
                                <span class="ms-3">Swap</span>
                            </a>
                        </li>
                        <li class="mb-4 py-2 px-5 rounded-pill">
                            <a href="https://www.defined.fi/arb/0x5bcb14eeb3739a2140ea23535c96394597c85e82"
                                class="text-decoration-none text-reset d-flex align-items-center">
                                <span class="ms-3">Chart</span>
                            </a>
                        </li>
                        <li class="mb-4 py-2 px-5 rounded-pill">
                            <a href=""
                                class="text-decoration-none text-reset d-flex align-items-center">
                                <span class="ms-3">Docs</span>
                            </a>
                        </li>
                    </ul>

                    <div class="d-flex justify-content-around w-100 px-4">
                        <a href=""
                            class="text-decoration-none text-reset fs-5 social-icon-hover">
                            <i class="bi bi-send-fill"></i>
                        </a>
                        <a href="https://twitter.com/RabbitHoleARB"
                            class="text-decoration-none text-reset fs-5 social-icon-hover">
                            <i class="bi bi-twitter"></i>
                        </a>
                        <a href=""
                            class="text-decoration-none text-reset fs-5 social-icon-hover">
                            <i class="bi bi-discord"></i>
                        </a>
                    </div>
                </div>
            </div>

            <div id="overlay" style="z-index: 1000001;"></div>

            <main class="col pt-4">
                <div class="w-100 position-fixed end-0 top-0" style="height: 68px; z-index: 100001;">
                    <div class="d-flex pt-3 px-sm-3">
                        <button type="button" id="showSidebar" class="d-lg-none btn fs-5"><i
                                class="bi bi-list"></i></button>

                        <div class="dropdown ms-auto">

                            <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="dropdownMenuButton1">
                                <li><a class="dropdown-item" href="">Buy
                                        on ZYB</a></li>
                                <li><a class="dropdown-item" href="">Chart</a>
                                </li>
                            </ul>
                        </div>

                        <button id="connect" type="button" class="btn rounded-1 ms-3">
                            Connect Wallet
                        </button>
                    </div>
                </div>

                <div class="container pt-3">
                    <div class="col-xl-8 mx-auto">

                        <div class="card border border-primary mt-5">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="p-4">
                                        <span class="text-secondary">
                                            APR
                                        </span>
                                        <h4 id="apy" class="fw-bold my-2">Loading...</h4>
                                        <span id="dailyroi" class="text-secondary">Daily ROI ~%</span>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="card border border-primary p-4">
                                        <span class="text-secondary">Your Balance</span>
                                        <h4 id="balanceInUsd" class="fw-bold my-2">$0.000</h4>
                                        <span id="balance" class="text-secondary">0.000 $CARROT</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card border border-primary p-3 p-sm-4 mt-5">
                            <div class="row justify-centent-between">
                                <div class="col">
                                    Your $CARROT
                                </div>

                                <div id="balance" class="col-auto text-primary">
                                    0.000
                                </div>
                            </div>
                            <div class="row justify-centent-between">
                                <div class="col">
                                    Fees (to burn)
                                </div>

                                <div class="col-auto text-primary">
                                    0.5%
                                </div>
                            </div>

                            <div class="col-sm-12 mt-3">
                                <label for="amount" class="form-label fw-medium">Stake Amount</label>
                                <div class="input-group border border-secondary rounded-1 mb-5">
                                    <input type="text" id="amount"
                                        class="form-control py-2 px-3 rounded-1 border-0 text-secondary"
                                        aria-describedby="amount-addon" value="0" placeholder="Amount">
                                    <span id="setMaxToAmount" class="input-group-text rounded-1 border-0">MAX</span>
                                </div>
                            </div>
                            <button id="stake" class="btn rounded-1 show" type="button" id="dropdownMenuButton1"
                                data-bs-toggle="dropdown" aria-expanded="true" data-bs-offset="0,14">
                                <span class="fw-medium ms-1">STAKE</span>
                                <span id="stakeA"></span>
                            </button>
                        </div>

                        <div class="card border border-primary p-3 p-sm-4 mt-5">
                            <div class="row justify-centent-between">
                                <div class="col">
                                    Your Staked
                                </div>

                                <div id="staked" class="col-auto text-primary">
                                    0.000
                                </div>
                            </div>
                            <div class="row justify-centent-between">
                                <div class="col">
                                    Staked In USD
                                </div>

                                <div id="stakedInUsd" class="col-auto text-primary">
                                    $0.000
                                </div>
                            </div>
                            <div class="row justify-centent-between">
                                <div class="col">
                                    Locked until
                                </div>

                                <div id="lockUntil" class="col-auto text-primary">
                                    ~
                                </div>
                            </div>
                            <div class="row justify-centent-between">
                                <div class="col">
                                    Pending Rewards (Maybe delay)
                                </div>

                                <div id="pending" class="col-auto text-primary">
                                    ~
                                </div>
                            </div>

                            <div class="col-sm-12 mt-3">
                                <label for="amount" class="form-label fw-medium">Withdraw Amount</label>
                                <div class="input-group border border-secondary rounded-1 mb-5">
                                    <input type="text" id="amountW"
                                        class="form-control py-2 px-3 rounded-1 border-0 text-secondary"
                                        aria-describedby="amount-addon" value="0" placeholder="Amount">
                                    <span id="setMaxToAmountW" class="input-group-text rounded-1 border-0">MAX</span>
                                </div>
                            </div>
                            <div class="card border border-primary p-3 p-sm-4 text-center">
                                <button id="withdraw" class="btn rounded-1 show" type="button" id="dropdownMenuButton1"
                                    data-bs-toggle="dropdown" aria-expanded="true" data-bs-offset="0,14">
                                    <span class="fw-medium ms-1">Withdraw</span>
                                    <span id="withdrawA"></span>
                                </button>
                                <button id="claim" class="btn rounded-1 show mt-2" type="button" id="dropdownMenuButton1"
                                    data-bs-toggle="dropdown" aria-expanded="true" data-bs-offset="0,14">
                                    <span class="fw-medium ms-1">Claim</span>
                                    <span id="claimA"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rangeslider.js@2.3.3/dist/rangeslider.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.1.0/bignumber.min.js'></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="./js/web3.min.js"></script>
    <script src="./js/detect-provider.js"></script>
    <script src="./js/ethers.umd.min.js"></script>
    <script src="js/base.js"></script>

    <script>
        let balance;
        let stakedAmount;
        let a;
        let ethPrice;
        let price;
        
        fetch('https://api.coingecko.com/api/v3/simple/price?ids=ethereum&vs_currencies=usd')
      .then(response => response.json())
      .then(data => {
        const etherPrice = data.ethereum.usd;
        ethPrice = etherPrice;
      })
      .catch(err => console.error(err));


        document.getElementById("showSidebar").addEventListener("click", function () {
            document.getElementById("sidebarContainer").classList.add("show");
            document.getElementById("overlay").style.display = "block"
        })

        document.getElementById("overlay").addEventListener("click", function () {
            document.getElementById("sidebarContainer").classList.remove("show");
            document.getElementById("overlay").style.display = "none"
        })

        async function stake(amount) {
            amount = amount * 10 ** 18;
            amount = amount.toLocaleString();
            amount = amount.toString().replace(/\$|,/g, '');
            await SEND_TX('chef', 'deposit', [0, amount]);
        }

        async function withdraw(amount) {
            amount = amount * 10 ** 18;
            amount = amount / a * 10 ** 24;
            amount = amount.toLocaleString();
            amount = amount.toString().replace(/\$|,/g, '');
            await SEND_TX('chef', 'withdraw', [0, amount]);
        }

        async function claim(address) {
            await SEND_TX('chef', 'claim', [0, address]);
        }

        let amountTo = [];
        let amountFrom = [];
        var dataL;
        var totalStaked = 0;

        async function doAfterConnect() {
            displayText('#connect', SHORTADR(CURADR));

            balance = await CONTS['web3'].balanceOf(CURADR);
            balance = balance / ETHDIV;

            let data = await CONTS['chef'].userInfo(0, CURADR);
            stakedAmount = data[0];
            let rewardDebt = data[1];
            let lockEndedTimestamp = data[2];
            a = data[3];

            displayText("#staked", `${COMMA(ROUND(Number(stakedAmount * a / (10 ** 24) / ETHDIV), 3))}`);
            displayText("#stakedInUsd", `$${COMMA(ROUND(Number(stakedAmount * a / (10 ** 24) / ETHDIV * price), 3))}`);
            
            if (new Date() >= lockEndedTimestamp * 1000) {
                displayText("#lockUntil", `Unlocked`);
            }else {
                displayText("#lockUntil", `${new Date(lockEndedTimestamp * 1000).toLocaleString() }`);
            }

            let pending = await CONTS['chef'].pendingReward(0, CURADR);
            pending = pending / ETHDIV;
            displayText("#pending", `${COMMA(INT(pending, 3))} $CARROT`);

            //ethPrice = 1 / (await getPrice('weth'));

            displayText("#balance", `${COMMA(INT(balance, 3))} $CARROT`);
            displayText("#balanceInUsd", `$${COMMA(INT(balance * price, 3))}`);
            
        }

        (async () => {
            // do global
            select('#connect').onclick = async () => { await conn(); };

            //ethPrice = 1 / (await getPrice('weth'));

            let liqReserves = await CONTS['pairweth'].getReserves();
            let liqEth = liqReserves[0] / ETHDIV;

            let liqEggs = liqReserves[1] / ETHDIV;
            let liqRate = liqEth / liqEggs;
            price = liqRate * ethPrice;
            displayText("#price", `$${COMMA(INT(price, 3))}`);

            let staked = await CONTS['web3'].balanceOf(ADRS["chef"]);
            let ra = 2000000000000000000000000 / staked * 200 / (900 + 200);
            let apy = ((ra) * ((60 / 12) * 60 * 24 * 365)) * 100;
            let dailyroi = (ra) * ((60 / 12) * 60 * 24) * 100;
            displayText("#apy", `${COMMA(ROUND(apy, 3))}%`);
            displayText("#dailyroi", `Daily ROI ${COMMA(ROUND(dailyroi, 3))}%`);


            $('[data-bs-toggle="tooltip"]').tooltip();

            await getCurAdr();
            console.log(getCurAdr());
            if (CURADR == null) {

            } else {
                await doAfterConnect();
                // display address
            }

            select('#setMaxToAmountW').onclick = async () => {
                select('#amountW').value = INT(Number(stakedAmount / (10 ** 24) * a / ETHDIV));
            };

            select('#setMaxToAmount').onclick = async () => {
                select('#amount').value = INT(balance - 1);
            };

            select('#stake').onclick = async () => {
                await stake(select('#amount').value);
            };

            select('#withdraw').onclick = async () => {
                await withdraw(select('#amountW').value);
            };

            select('#claim').onclick = async () => {
                await claim(CURADR);
            };

            $('[data-bs-toggle="tooltip"]').tooltip();
        })();




    </script>
</body>

</html>